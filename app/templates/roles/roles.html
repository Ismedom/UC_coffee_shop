{% extends "base_panel.html" %} {% block title %}Roles Management{% endblock %}
{% block content %}
<div class="mb-6">
  <h1 class="text-3xl font-bold text-gray-800">Roles & Permissions</h1>
  <p class="text-gray-600 mt-2">
    Manage user roles and their permissions across the system
  </p>
</div>

<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-semibold text-gray-700">Roles List</h2>
    <button
      id="openCreateRole"
      class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center"
    >
      <i class="fas fa-plus-circle mr-2"></i>
      Create New Role
    </button>
  </div>

  <div
    id="createRoleForm"
    class="bg-blue-50 p-6 rounded-lg border border-blue-100 mb-6 hidden transition-all duration-300"
  >
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold text-gray-800">Create New Role</h2>
      <button id="closeCreateRole" class="text-gray-500 hover:text-gray-700">
        <i class="fas fa-times text-lg"></i>
      </button>
    </div>
    <form method="POST" action="/roles/create" class="space-y-4">
      <div>
        <label for="name" class="block text-sm font-medium text-gray-700 mb-1"
          >Role Name</label
        >
        <input
          type="text"
          name="name"
          id="name"
          required
          class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 py-2 px-3 border"
          placeholder="Enter role name"
        />
      </div>

      <div>
        <label
          for="description"
          class="block text-sm font-medium text-gray-700 mb-1"
          >Description</label
        >
        <textarea
          name="description"
          id="description"
          rows="3"
          class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 py-2 px-3 border"
          placeholder="Enter description"
        ></textarea>
      </div>

      <div class="pt-2">
        <button
          type="submit"
          class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors duration-200"
        >
          Create Role
        </button>
        <button
          type="button"
          id="cancelCreateRole"
          class="ml-2 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 transition-colors duration-200"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Role Name
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Description
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Users
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Actions
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for role in roles %}
        <tr class="hover:bg-gray-50 transition-colors duration-150">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div
                class="flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center"
              >
                <i class="fas fa-user-shield text-blue-600"></i>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-900">
                  {{ role.name }}
                </div>
              </div>
            </div>
          </td>
          <td class="px-6 py-4">
            <div class="text-sm text-gray-700 max-w-xs">
              {{ role.description }}
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span
              class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"
            >
              {{ role.user_count }} users
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <a
              href="/roles/edit/{{ role.id }}"
              class="text-indigo-600 hover:text-indigo-900 mr-3"
              title="Edit Role"
            >
              <i class="fas fa-edit"></i>
            </a>
            <a
              href="/roles/permissions/{{ role.id }}"
              class="text-purple-600 hover:text-purple-900 mr-3"
              title="Manage Permissions"
            >
              <i class="fas fa-key"></i>
            </a>
            <button class="text-red-600 hover:text-red-900" title="Delete Role">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if not roles %}
  <div class="text-center py-12">
    <div class="text-gray-400 mb-4">
      <i class="fas fa-user-shield text-5xl"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-700 mb-2">No roles found</h3>
    <p class="text-gray-500">Get started by creating your first role</p>
  </div>
  {% endif %}
</div>

<script>
  const openBtn = document.getElementById("openCreateRole");
  const formDiv = document.getElementById("createRoleForm");
  const closeBtn = document.getElementById("closeCreateRole");
  const cancelBtn = document.getElementById("cancelCreateRole");

  openBtn.addEventListener("click", () => {
    formDiv.classList.remove("hidden");
    formDiv.scrollIntoView({ behavior: "smooth" });
  });

  function closeForm() {
    formDiv.classList.add("hidden");
  }

  if (closeBtn) closeBtn.addEventListener("click", closeForm);
  if (cancelBtn) cancelBtn.addEventListener("click", closeForm);

  document.addEventListener("click", (e) => {
    if (
      formDiv &&
      !formDiv.classList.contains("hidden") &&
      !formDiv.contains(e.target) &&
      e.target !== openBtn
    ) {
      closeForm();
    }
  });
</script>

{% endblock %}
