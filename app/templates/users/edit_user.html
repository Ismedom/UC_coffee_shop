{% extends "base_panel.html" %} {% block title %}Edit User{% endblock %} {%
block content %}
<div class="mb-6">
  <h1 class="text-3xl font-bold text-gray-800">Edit User</h1>
  <p class="text-gray-600 mt-2">Update user information and permissions</p>
</div>

<div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
  <div class="flex items-center mb-6">
    <div
      class="flex-shrink-0 h-12 w-12 bg-indigo-100 rounded-full flex items-center justify-center mr-4"
    >
      <i class="fas fa-user-edit text-indigo-600 text-xl"></i>
    </div>
    <div>
      <h2 class="text-xl font-semibold text-gray-800">Update User</h2>
      <p class="text-gray-500 text-sm">ID: {{ user.id }}</p>
    </div>
  </div>

  <form method="POST" action="/users/edit/{{ user.id }}" class="space-y-6">
    <div>
      <label for="username" class="block text-sm font-medium text-gray-700 mb-1"
        >Username</label
      >
      <input
        type="text"
        name="username"
        id="username"
        value="{{ user.username }}"
        required
        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 py-2 px-3 border"
      />
    </div>

    <!-- <div>
      <label for="email" class="block text-sm font-medium text-gray-700 mb-1"
        >Email Address</label
      >
      <input
        type="email"
        name="email"
        id="email"
        value="{{ user.email }}"
        required
        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 py-2 px-3 border"
      />
    </div> -->

    <div>
      <label for="password" class="block text-sm font-medium text-gray-700 mb-1"
        >Password</label
      >
      <div class="relative">
        <input
          type="password"
          name="password"
          id="password"
          placeholder="Leave blank to keep current password"
          class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 py-2 px-3 border"
        />
        <button
          type="button"
          id="togglePassword"
          class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"
          style="top: 1.75rem"
        >
          <i class="fas fa-eye absolute right-3 -top-3"></i>
        </button>
      </div>
      <p class="text-xs text-gray-500 mt-1">
        Minimum 8 characters with letters and numbers
      </p>
    </div>

    <div class="pt-4 border-t border-gray-200">
      <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
        <i class="fas fa-user-shield mr-2 text-purple-500"></i>
        User Roles
      </h3>
      <p class="text-gray-600 text-sm mb-4">
        Select roles to assign to this user
      </p>

      <div class="bg-gray-50 p-4 rounded-lg">
        <div class="flex items-center justify-between mb-4">
          <span class="text-sm text-gray-600">
            {% set user_role_count = user.roles | length %} {{ user_role_count
            }} of {{ roles | length }} roles assigned
          </span>
          <div class="flex space-x-2">
            <button
              type="button"
              id="selectAllRoles"
              class="text-xs text-indigo-600 hover:text-indigo-800"
            >
              Select All
            </button>
            <button
              type="button"
              id="deselectAllRoles"
              class="text-xs text-gray-600 hover:text-gray-800"
            >
              Deselect All
            </button>
          </div>
        </div>

        <div
          class="space-y-2 grid grid-cols-2 p-2 border border-gray-200 rounded-lg bg-white"
        >
          {% for role in roles %}
          <label
            class="flex items-start p-2 rounded hover:bg-gray-50 transition-colors duration-150"
          >
            <input
              type="checkbox"
              name="roles"
              value="{{ role.id }}"
              {%
              if
              role
              in
              user.roles
              %}checked{%
              endif
              %}
              class="mt-1 form-checkbox h-4 w-4 text-indigo-600"
            />
            <span class="ml-2 text-gray-700">
              <span class="block text-sm font-medium capitalize"
                >{{ role.name }}</span
              >
              {% if role.description %}
              <span class="block text-xs text-gray-500 mt-1"
                >{{ role.description }}</span
              >
              {% endif %}
            </span>
          </label>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="pt-4 border-t border-gray-200">
      <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
        <i class="fas fa-toggle-on mr-2 text-green-500"></i>
        Account Status
      </h3>
      <div class="flex items-center">
        <label class="inline-flex items-center">
          <input
            type="checkbox"
            name="is_active"
            value="true"
            {%
            if
            user.is_active
            %}checked{%
            endif
            %}
            class="form-checkbox h-5 w-5 text-indigo-600"
          />
          <span class="ml-2 text-gray-700">Active Account</span>
        </label>
      </div>
      <p class="text-xs text-gray-500 mt-2">
        Deactivating will prevent user from logging in
      </p>
    </div>

    <div class="flex items-center justify-between pt-4">
      <div>
        <button
          type="submit"
          class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors duration-200 flex items-center"
        >
          <i class="fas fa-save mr-2"></i>
          Update User
        </button>
      </div>
      <div>
        <a
          href="/users"
          class="text-gray-600 hover:text-gray-800 hover:underline flex items-center"
        >
          <i class="fas fa-times mr-2"></i>
          Cancel
        </a>
      </div>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const togglePassword = document.getElementById("togglePassword");
    const passwordField = document.getElementById("password");

    if (togglePassword && passwordField) {
      togglePassword.addEventListener("click", function () {
        const type =
          passwordField.getAttribute("type") === "password"
            ? "text"
            : "password";
        passwordField.setAttribute("type", type);

        const icon = togglePassword.querySelector("i");
        if (type === "password") {
          icon.classList.remove("fa-eye-slash");
          icon.classList.add("fa-eye");
        } else {
          icon.classList.remove("fa-eye");
          icon.classList.add("fa-eye-slash");
        }
      });
    }

    document
      .getElementById("selectAllRoles")
      .addEventListener("click", function () {
        const checkboxes = document.querySelectorAll('input[name="roles"]');
        checkboxes.forEach((checkbox) => {
          checkbox.checked = true;
        });
        updateRoleCount();
      });

    document
      .getElementById("deselectAllRoles")
      .addEventListener("click", function () {
        const checkboxes = document.querySelectorAll('input[name="roles"]');
        checkboxes.forEach((checkbox) => {
          checkbox.checked = false;
        });
        updateRoleCount();
      });

    const roleCheckboxes = document.querySelectorAll('input[name="roles"]');
    function updateRoleCount() {
      const selectedCount = document.querySelectorAll(
        'input[name="roles"]:checked'
      ).length;
      const totalCount = roleCheckboxes.length;
      document.querySelector(
        ".text-sm.text-gray-600"
      ).textContent = `${selectedCount} of ${totalCount} roles assigned`;
    }

    roleCheckboxes.forEach((checkbox) => {
      checkbox.addEventListener("change", updateRoleCount);
    });
  });
</script>
{% endblock %}
